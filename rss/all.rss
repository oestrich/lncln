<? 
/**
 * all.rss
 *
 * @author Eric Oestrich
 * @version 0.6.0
 * 
 * @package lncln
 */

header('Content-type: text/xml'); 

require_once("../config.php");
require_once("../functions.php");

if(!@mysql_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD)){
	die("Error with MySQL: " . mysql_error());
}
mysql_select_db(DB_DATABASE);

$sql = "SELECT id, caption, postTime, type FROM images WHERE queue = 0 AND postTime <= " . time() . " ORDER BY `id` DESC LIMIT 50";
$result = mysql_query($sql);

$server = "http://" . $_SERVER['SERVER_NAME'] . str_replace("rss/all.rss", "", $_SERVER['SCRIPT_NAME']);

?>
<rss version="2.0">
<channel>

<title>The Archive</title>
<link><?echo $server;?></link>
<description>All Images</description>
<lastBuildDate>Mon, 26 Jan 2009 18:37:00 EST</lastBuildDate>
<language>en-us</language>

<?
while($row = mysql_fetch_assoc($result)){
?>
	<item>
		<title><?echo $row['id'];?></title>
		<link><?echo $server;?>image.php?img=<?echo $row['id'];?></link>
		<guid><?echo $server;?>image.php?img=<?echo $row['id'];?></guid>
		<pubDate><?echo date('r', $row['postTime']);?></pubDate>
		<description><![CDATA[ <img src="<?echo $server;?>normal/<?echo $row['id'] . "." . $row['type']?>" alt="<?echo $row['id'];?>"/> <br />
		<?echo $row['caption'];?>
		]]></description>
	</item>
<?
}
?>

</channel>
</rss>