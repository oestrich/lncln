<? 
/**
 * safe.rss
 * 
 * @copyright (C) 2009 Eric Oestrich
 * @version 0.7.0 $Id$
 * 
 * @package lncln
 */
 
header('Content-type: text/xml'); 

require_once("../config.php");
require_once("../includes/functions.php");

connect();

$sql = "SELECT id, caption, postTime, type FROM images WHERE obscene = 0 AND queue = 0 AND postTime <= " . time() . " ORDER BY `id` DESC LIMIT 50";
$result = mysql_query($sql);

$server = "http://" . $_SERVER['SERVER_NAME'] . str_replace("rss/safe.rss", "", $_SERVER['SCRIPT_NAME']);

?>
<rss version="2.0">
<channel>

<title>The Archive</title>
<link><?echo $server;?></link>
<description>All Images - Minus Obscene</description>
<lastBuildDate>Mon, 26 Jan 2009 18:37:00 EST</lastBuildDate>
<language>en-us</language>

<?
while($row = mysql_fetch_assoc($result)){
?>
	<item>
		<title><?echo $row['id'];?></title>
		<link><?echo $server;?>image.php?img=<?echo $row['id'];?></link>
		<guid><?echo $server;?>image.php?img=<?echo $row['id'];?></guid>
		<pubDate><?echo date('r', $row['postTime']);?></pubDate>
		<description><![CDATA[ <img src="<?echo $server;?>images/index/<?echo $row['id'] . "." . $row['type']?>" alt="<?echo $row['id'];?>"/> <br />
		<?echo $row['caption'];?>
		]]></description>
	</item>
<?
}
?>

</channel>
</rss>